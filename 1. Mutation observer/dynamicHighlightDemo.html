<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>MutationObserver + Prism Demo</title>

    <!-- Prism CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- TARGET ELEMENT -->
    <div id="highlight-demo"></div>

    <!-- Prism JS -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-css.min.js"></script>

    <script>
      let observer = new MutationObserver((mutations) => {
        for (let mutation of mutations) {
          for (let node of mutation.addedNodes) {
            if (!(node instanceof HTMLElement)) continue;

            if (node.matches('pre[class*="language-"]')) {
              Prism.highlightElement(node);
            }

            for (let elem of node.querySelectorAll('pre[class*="language-"]')) {
              Prism.highlightElement(elem);
            }
          }
        }
      });

      let demoElem = document.getElementById('highlight-demo');

      observer.observe(demoElem, { childList: true, subtree: true });

      // Inject HTML dynamically
      demoElem.innerHTML = `
        <p>A code snippet is below:</p>
        <pre class="language-javascript"><code>
let hello = "world!";
console.log(hello);
        </code></pre>

        <div>Another one:</div>
        <div>
          <pre class="language-css"><code>
.class {
  margin: 5px;
}
          </code></pre>
        </div>
      `;
    </script>
  </body>
</html>
